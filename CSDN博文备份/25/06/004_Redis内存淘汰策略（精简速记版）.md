# Redis内存淘汰策略（精简速记版）

> 原创 于 2025-06-13 13:28:43 发布 · 公开 · 1k 阅读 · 19 · 22 · CC 4.0 BY-SA版权 版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。
> 文章链接：https://blog.csdn.net/lyh2004_08/article/details/148630509

**目录**

[TOC]



## 一、内存淘汰策略概述

Redis提供了8种内存淘汰策略，当内存使用达到 `maxmemory` 限制时触发：

1.  **noeviction** （ **默认策略** ）：不淘汰任何数据，当内存不足时，新写入操作会报错

2.  **allkeys-lru** ：从所有key中淘汰最近最少使用的key

3.  **volatile-lru** ：从设置了过期时间的key中淘汰最近最少使用的key

4.  **allkeys-lfu** ：从所有key中淘汰最不经常使用的key

5.  **volatile-lfu** ：从设置了过期时间的key中淘汰最不经常使用的key

6.  **allkeys-random** ：从所有key中随机淘汰

7.  **volatile-random** ：从设置了过期时间的key中随机淘汰

8.  **volatile-ttl** ：从设置了过期时间的key中淘汰剩余生存时间(TTL)最短的key

>  **速记** ：除默认策略外，所有策略按 `allkeys` （全体Key）和 `volatile` （仅过期Key）两大维度划分，再结合 `LRU/LFU/TTL/Random` 四种淘汰标准

---

## 二、LRU与LFU详解

#### 1. LRU (Least Recently Used 最近最少使用)

>  **关键** ：
> 
> 

-  **用当前时间减去最后一次访问时间，这个值越大，淘汰优先级越高** 

- 基于"最近被访问的时间"进行淘汰

- 认为最近没有被访问过的数据在未来被访问的概率也低

#### 2. LFU (Least Frequently Used 最不经常使用)

>  **关键** ：
> 
> 

- 最少频率使用，会统计每个key的访问频率，值越小，淘汰优先级越高

- 基于"访问频率"进行淘汰<span style="color:#4d4d4d"></span>

> 平时开发过程中用的比较多的就是<span style="color:#fe2c24">allkeys-lru</span>策略（结合自己的业务场景）

---

## 三、和Redis数据过期的联系

### 横向对比

|  | 数据过期 | 数据淘汰 |
|:---:|:---:|:---:|
|  **触发时机**  | Key到达TTL时刻 | 内存达到maxmemory限制 |
|  **处理对象**  | 仅针对设置了TTL的Key | 根据策略可能包含所有Key |
|  **删除标准**  | 只删除已过期数据 | 可能删除未过期但"价值低"的数据 |
|  **执行频率**  | 持续进行 **（惰性+定期）**  | 仅在 **内存不足时** 触发 |
|  **是否可配置**  | 只能配置定期删除频率 | 可配置8种不同策略 |
|  **数据一致性影响**  | 只删除程序逻辑允许失效的数据 | 可能删除程序仍需要的数据 |


### 其他联系

> #### 数据过期可能触发数据淘汰

- 当大量Key同时过期时，定期删除可能来不及处理

- 这些"已过期但未被删除"的Key仍占用内存空间

- 可能导致 **内存提前达到maxmemory** 触发淘汰

---

## 四、其他可能面试题

Q： **Redis的内存用完了会发生什么？** 

> A：这个要看redis的数据淘汰策略是什么。如果是默认的配置，redis内存用完以后则直接报错。我们当时设置的是allkeys-lru策略，把最近最常访问的数据留在缓存中。

Q： **如何避免大量Key同时过期？** 

> A：在基础过期时间上增加随机偏移量，如： `EXPIRE key 86400 + random(0, 3600)` 

Q： **数据库有1000万数据，Redis只能缓存20万数据。如何保证Redis中的数据都是热点数据？** 

> A：可以使用allkeys-lru（挑选最近最少使用的数据淘汰）淘汰策略。留下来的都是经常访问的热点数据。

---

[LRU算法](https://zh.wikipedia.org/wiki/%E5%BF%AB%E5%8F%96%E6%96%87%E4%BB%B6%E7%BD%AE%E6%8F%9B%E6%A9%9F%E5%88%B6)